{% load static %}
{% load socialaccount %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% if company.name %}{{ company.name }}{% else %}Nayelina AI{% endif %}</title>

    <!-- Favicon -->
    {% if company.favicon %}
        <link rel="icon" href="{{ company.favicon.url }}">
    {% else %}
        <link rel="icon" href="data:,">
    {% endif %}

    <!-- Estilos -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="{% static 'myapp/css/styles.css' %}">

    <!-- INYECCIÓN DINÁMICA DE COLORES DESDE EL ADMIN -->
    {% if company %}
    <style>
        :root {
            /* Colores Base con !important para asegurar prioridad */
            --primary-start: {{ company.primary_color_start|default:"#a855f7" }};
            --primary-mid: {{ company.primary_color_mid|default:"#ef4444" }};
            --primary-end: {{ company.primary_color_end|default:"#ff9068" }};
            --accent-glow: {{ company.accent_glow_color|default:"#ef4444" }};
            --offer-bar-color: {{ company.offer_bar_color|default:"#10b981" }}; /* NUEVO */

            /* Variables derivadas para usar en styles.css */
            --primary-color: var(--primary-mid);
            --primary-gradient: linear-gradient(135deg, var(--primary-start) 0%, var(--primary-mid) 50%, var(--primary-end) 100%);

            /* Glows dinámicos (con opacidad) */
            --primary-glow: color-mix(in srgb, var(--accent-glow), transparent 50%);

            /* Fondo dinámico (usando los colores elegidos) */
            --bg-gradient:
                radial-gradient(circle at 50% -20%, color-mix(in srgb, var(--primary-start), transparent 85%) 0%, transparent 50%),
                radial-gradient(circle at 0% 30%, color-mix(in srgb, var(--primary-mid), transparent 90%) 0%, transparent 40%),
                radial-gradient(circle at 100% 70%, color-mix(in srgb, var(--primary-start), transparent 92%) 0%, transparent 40%),
                linear-gradient(to bottom, #0f0505 0%, #020202 100%);
        }

        /* Sobrescribir la barra de ofertas con el color personalizado */
        .oferta-bar {
            /* CAMBIO: Usamos background-image para NO bloquear la posición (que la mueve la animación) */
            background-image:
                repeating-linear-gradient(
                    45deg,
                    rgba(0, 0, 0, 0.15),
                    rgba(0, 0, 0, 0.15) 10px,
                    rgba(0, 0, 0, 0.05) 10px,
                    rgba(0, 0, 0, 0.05) 20px
                ),
                linear-gradient(90deg,
                    color-mix(in srgb, var(--offer-bar-color), black 20%),
                    var(--offer-bar-color),
                    color-mix(in srgb, var(--offer-bar-color), black 20%)
                ) !important;

            /* Aseguramos el tamaño para que haya espacio para moverse */
            background-size: 200% 200% !important;

            border-bottom-color: color-mix(in srgb, var(--offer-bar-color), white 20%) !important;
            box-shadow: 0 4px 25px color-mix(in srgb, var(--offer-bar-color), transparent 40%) !important;

            /* Definimos AMBAS animaciones explícitamente */
            animation: stripesMove 20s linear infinite, glowPulseCustom 3s ease-in-out infinite !important;
        }

        /* Animación de pulso adaptada al color personalizado */
        @keyframes glowPulseCustom {
            0%, 100% {
                box-shadow: 0 4px 15px color-mix(in srgb, var(--offer-bar-color), transparent 60%);
                border-bottom-color: var(--offer-bar-color);
            }
            50% {
                box-shadow: 0 4px 30px color-mix(in srgb, var(--offer-bar-color), transparent 30%);
                border-bottom-color: color-mix(in srgb, var(--offer-bar-color), white 50%);
            }
        }
    </style>
    {% endif %}

    <style>
        /* Estilo para el Botón Flotante (FAB) */
        .fab-create {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: var(--primary-gradient);
            color: white;
            padding: 12px 28px;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: 700;
            text-decoration: none;
            box-shadow: 0 10px 25px rgba(255, 75, 75, 0.4);
            display: flex;
            align-items: center;
            gap: 12px;
            z-index: 1000;
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            letter-spacing: 0.5px;

            /* Inicialmente oculto y pequeño para la animación de entrada */
            opacity: 0;
            transform: scale(0) translateY(20px);
            pointer-events: none; /* No clicable mientras está oculto */
        }

        .fab-create.visible {
            opacity: 1;
            transform: scale(1) translateY(0);
            pointer-events: auto;
        }

        .fab-create:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 15px 35px rgba(255, 75, 75, 0.6);
        }

        /* Icono SVG Estrella 4 Puntas (Grupo) */
        .star-icon {
            width: 24px;
            height: 24px;
            fill: white;
            filter: drop-shadow(0 0 2px rgba(255,255,255,0.6));
        }

        /* Icono SVG Estrella Pequeño (Para menús) */
        .star-icon-sm {
            width: 18px;
            height: 18px;
            fill: currentColor; /* Hereda el color del texto */
        }

        /* Partícula viajera (Estrella fugaz) */
        .traveling-star {
            position: fixed;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            box-shadow: 0 0 15px 5px rgba(255, 255, 255, 0.8), 0 0 30px 10px var(--primary-color);
            z-index: 9999;
            pointer-events: none;
            opacity: 0;
            transform: translate(-50%, -50%);
        }

        .traveling-star::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 100px;
            height: 2px;
            background: linear-gradient(90deg, white, transparent);
            transform: translateY(-50%) rotate(180deg); /* Cola hacia atrás */
            transform-origin: left center;
            opacity: 0.6;
        }

        /* Estilo para ocultar el botón original suavemente */
        .cta-button {
            transition: opacity 0.3s ease, transform 0.3s ease;
        }
        .cta-button.hidden-hero {
            opacity: 0;
            pointer-events: none;
            transform: scale(0.8);
        }

        /* Ajuste para móvil: subirlo un poco para no tapar el bottom nav */
        @media (max-width: 768px) {
            .fab-create {
                bottom: 80px;
                right: 20px;
                padding: 12px 24px;
                font-size: 1rem;
            }
        }
    </style>
</head>
<body>

    <!-- Cabecera -->
    <header>
        <a href="/" class="logo-container">
            {% if company.logo %}
                <div class="logo-wrapper">
                    <img src="{{ company.logo.url }}" alt="Logo" class="logo">
                </div>
            {% endif %}
            <h1>{% if company.name %}{{ company.name }}{% else %}Nayelina AI{% endif %}</h1>
        </a>

        <div class="user-menu">
            {% if user.is_authenticated %}
                <!-- Botón GALERÍA -->
                <a href="{% url 'gallery' %}" class="action-btn gallery-btn desktop-nav-btn">
                    <i class="fas fa-images"></i> Gallery
                </a>

                <!-- Botón CUPONES (NUEVO) -->
                <button onclick="document.getElementById('modal-coupon').style.display='block'" class="action-btn desktop-nav-btn" style="background: rgba(251, 191, 36, 0.1); color: #fbbf24; border: 1px solid rgba(251, 191, 36, 0.3); cursor: pointer;">
                    <i class="fas fa-ticket-alt"></i> Coupons
                </button>

                <!-- Contador de Tokens -->
                {% if user.is_authenticated and not user.is_staff %}
                <div class="token-badge">
                    <i class="fas fa-coins"></i>
                    <span>{{ user.clientprofile.tokens_remaining }} Tokens</span>
                </div>
                {% endif %}

                <!-- AVATAR CLICABLE (PERFIL) -->
                <a href="{% url 'profile' %}" class="user-avatar" style="text-decoration: none;">
                    {{ user.username|slice:":1"|upper }}
                </a>

            {% else %}
                <div class="auth-links">
                    <a href="{% url 'account_login' %}">Login</a>
                    <a href="{% url 'account_signup' %}" style="color: var(--primary-color);">Sign Up</a>
                </div>
            {% endif %}
        </div>
    </header>

    <!-- Barra de Oferta -->
    {% if company.offer_bar_text %}
    <div class="oferta-bar">
        {{ company.offer_bar_text }}
    </div>
    {% endif %}

    <!-- Sección Principal (Hero) -->
    <section class="hero-section">
        <div class="hero-text">
            <h1>{% if company.app_hero_title %}{{ company.app_hero_title }}{% else %}Anime - Realistic Generator{% endif %}</h1>

            <!-- SUBTÍTULO (MEJORADO) -->
            {% if company.app_hero_subtitle %}
                <h2 style="font-size: 2rem; font-weight: 800; margin: 15px 0; color: #e2e8f0; text-shadow: 0 2px 10px rgba(0,0,0,0.5); letter-spacing: 0.5px;">
                    {{ company.app_hero_subtitle }}
                </h2>
            {% endif %}

            <p>{% if company.app_hero_description %}{{ company.app_hero_description }}{% else %}Transform your ideas into art with our powerful AI engine. Create unique characters in seconds.{% endif %}</p>

            <!-- BOTÓN HERO (ID agregado para JS) -->
            <!-- CAMBIO: Ahora redirige al Workspace -->
            <a href="{% url 'workspace' %}" id="hero-cta-btn" class="cta-button">Start Creating</a>
        </div>

        <!-- Carrusel Hero -->
        <div class="hero-carousel-wrapper" id="hero-carousel">
            {% for item in hero_items %}
                <div class="hero-slide {% if forloop.first %}active{% endif %}">
                    <div class="hero-image-half">
                        <img src="{{ item.image_url }}" alt="{{ item.name }}">
                        <div class="hero-caption">{{ item.name }}</div>
                    </div>
                </div>
            {% empty %}
                <div class="hero-slide active" style="display: flex; justify-content: center; align-items: center; background: #1e293b; color: #64748b;">
                    <div style="text-align: center;">
                        <i class="fas fa-image" style="font-size: 3rem; margin-bottom: 15px; display: block;"></i>
                        <span>No images available</span>
                    </div>
                </div>
            {% endfor %}
        </div>
    </section>

    <!-- Sección Personajes -->
    <section class="personajes-section" id="personajes-list">
        <!-- FILTROS DE CATEGORÍA -->
        <div class="filter-buttons-container">
            <button class="filter-btn active" onclick="filterCategory('ALL', this)">All</button>
            {% for cat in all_categories %}
                <button class="filter-btn" onclick="filterCategory('{{ cat.id }}', this)">{{ cat.name }}</button>
            {% endfor %}
        </div>

        <!-- FILTROS DE SUBCATEGORÍAS (TAGS) -->
        <div class="sub-filter-container" style="display:flex; flex-wrap:wrap; justify-content:center; margin-bottom:30px; gap: 8px;">
            {% for sub in all_subcategories %}
                <button class="filter-btn" style="font-size: 0.8rem; padding: 6px 16px; border-style: dashed;" onclick="toggleSubCategory('{{ sub.id }}', this)">#{{ sub.name }}</button>
            {% endfor %}
        </div>

        <div class="album-container">
            {% for character in characters %}
            <a href="{% url 'workspace' %}?character_id={{ character.id }}" class="character-card"
               data-character-id="{{ character.id }}"
               data-category-id="{{ character.category.id|default:'NONE' }}"
               data-subcategory-id="{{ character.subcategory.id|default:'NONE' }}">

                <!-- Carrusel de Imágenes (Fondo) -->
                <div class="carousel">
                    {% if character.catalog_images_set.all %}
                        {% for image in character.catalog_images_set.all %}
                        <img src="{{ image.image.url }}" class="carousel-image {% if forloop.first %}active{% endif %}" alt="{{ character.name }}">
                        {% endfor %}

                        <!-- Indicadores de Progreso (Arriba a la derecha) -->
                        <div class="carousel-progress-bar">
                            {% for image in character.catalog_images_set.all %}
                            <div class="progress-segment {% if forloop.first %}active{% endif %}"></div>
                            {% endfor %}
                        </div>
                    {% else %}
                        <div class="carousel-image active" style="display: flex; justify-content: center; align-items: center; background: #1e293b; color: #64748b;">
                            <i class="fas fa-image" style="font-size: 2rem;"></i>
                        </div>
                    {% endif %}
                </div>

                <!-- Overlay de Información (Sobre la imagen) -->
                <div class="card-overlay">
                    <h2>{{ character.name }}</h2>
                    {% if character.description %}
                    <p>{{ character.description|truncatechars:80 }}</p>
                    {% endif %}

                    <div class="chat-badge">
                        <i class="fas fa-comment-dots"></i> Chat Now
                    </div>
                </div>
            </a>
            {% endfor %}
        </div>
    </section>

    <!-- BOTÓN FLOTANTE (FAB) CON ESTRELLAS IA -->
    {% if user.is_authenticated %}
    <a href="{% url 'workspace' %}" class="fab-create" id="fab-create-btn">
        <!-- SVG Grupo de Estrellas 4 Puntas -->
        <svg class="star-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <!-- Estrella Grande -->
            <path d="M12 2L14 9L21 11L14 13L12 20L10 13L3 11L10 9L12 2Z" />
            <!-- Estrella Mediana (Arriba Derecha) -->
            <path d="M19 2L20 5L23 6L20 7L19 10L18 7L15 6L18 5L19 2Z" />
            <!-- Estrella Pequeña (Abajo Izquierda) -->
            <path d="M5 16L6 18L9 19L6 20L5 23L4 20L1 19L4 18L5 16Z" />
        </svg>
        Create
    </a>
    {% endif %}

    <!-- Elemento para la animación de la estrella viajera -->
    <div id="star-particle" class="traveling-star"></div>

    <!-- Footer -->
    <footer>
        <div class="footer-content">
            <div class="footer-section">
                <h3>About Us</h3>
                <p>{% if company.description %}{{ company.description }}{% else %}Leading platform in AI art generation.{% endif %}</p>
            </div>
            <div class="footer-section">
                <h3>Contact</h3>
                {% if company.phone %}<p><i class="fas fa-phone"></i> {{ company.phone }}</p>{% endif %}
                {% if company.email %}<p><i class="fas fa-envelope"></i> {{ company.email }}</p>{% endif %}
            </div>
            <div class="footer-section">
                <h3>Follow Us</h3>
                <div class="social-links">
                    {% if company.facebook %}
                        <a href="{{ company.facebook }}" target="_blank" title="Facebook"><i class="fab fa-facebook-f"></i></a>
                    {% endif %}
                    {% if company.discord %}
                        <a href="{{ company.discord }}" target="_blank" title="Discord"><i class="fab fa-discord"></i></a>
                    {% endif %}
                </div>
            </div>
        </div>
        <div class="copyright">
            &copy; {% now "Y" %} {% if company.name %}{{ company.name }}{% else %}Nayelina AI{% endif %}. All rights reserved.
        </div>
    </footer>

    <!-- Bottom Navigation for Mobile -->
    <nav class="bottom-nav">
        <a href="{% url 'generate_image' %}" class="bottom-nav-item active">
            <i class="fas fa-home"></i>
            <span>Home</span>
        </a>
        <a href="{% url 'workspace' %}" class="bottom-nav-item">
            <!-- SVG Estrellas (Pequeño) -->
            <svg class="star-icon-sm" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 2L14 9L21 11L14 13L12 20L10 13L3 11L10 9L12 2Z" />
                <path d="M19 2L20 5L23 6L20 7L19 10L18 7L15 6L18 5L19 2Z" />
                <path d="M5 16L6 18L9 19L6 20L5 23L4 20L1 19L4 18L5 16Z" />
            </svg>
            <span>Workspace</span>
        </a>
        <a href="{% url 'gallery' %}" class="bottom-nav-item">
            <i class="fas fa-images"></i>
            <span>Gallery</span>
        </a>
    </nav>

    <!-- MODAL DE CANJE DE CUPÓN (NUEVO EN GENERATE) -->
    <div id="modal-coupon" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 style="margin:0; color:white;">Redeem Coupon</h3>
                <span onclick="document.getElementById('modal-coupon').style.display='none'" style="cursor:pointer; color:white;">&times;</span>
            </div>
            <div class="modal-body">
                <div id="coupon-input-container">
                    <p style="color:var(--text-muted); margin-bottom:15px;">Enter your coupon code to receive extra tokens.</p>
                    <input type="text" id="coupon-code" placeholder="Enter code here..." style="width:100%; padding:10px; background:#0f172a; border:1px solid var(--border-subtle); color:white; border-radius:8px; margin-bottom:15px; box-sizing:border-box;">
                    <div id="coupon-message" style="margin-top:10px; font-size:0.9rem;"></div>
                </div>

                <div id="coupon-success-container" class="success-animation-container" style="display:none;">
                    <i class="fas fa-check-circle success-icon"></i>
                    <div id="success-text" class="success-text"></div>
                </div>
            </div>
            <div class="modal-footer" id="coupon-footer">
                <button class="modal-btn modal-btn-secondary" onclick="document.getElementById('modal-coupon').style.display='none'">Cancel</button>
                <button class="modal-btn" style="background-color:var(--primary-blue); color:white;" onclick="redeemCoupon()">Redeem</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script>
        window.DjangoContext = {
            userIsAuthenticated: {{ user.is_authenticated|yesno:"true,false" }},
            loginUrl: "{% url 'account_login' %}",
            generateUrl: "{% url 'generate_image' %}",
            csrfToken: "{{ csrf_token }}"
        };

        // URL para canjear cupones (necesaria para el script)
        const redeemCouponUrl = "{% url 'redeem_coupon' %}";
        const csrfToken = "{{ csrf_token }}";

        // --- LÓGICA DE FILTRADO ---
        function filterCategory(categoryId, btn) {
            document.querySelectorAll('.filter-buttons-container .filter-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            document.getElementById('personajes-list').dataset.activeCategory = categoryId;
            applyFilters();
        }

        function toggleSubCategory(subId, btn) {
            btn.classList.toggle('active');
            const list = document.getElementById('personajes-list');
            let activeSubs = list.dataset.activeSubs ? list.dataset.activeSubs.split(',') : [];

            if (btn.classList.contains('active')) {
                activeSubs.push(subId);
            } else {
                activeSubs = activeSubs.filter(id => id !== subId);
            }
            list.dataset.activeSubs = activeSubs.join(',');
            applyFilters();
        }

        function applyFilters() {
            const list = document.getElementById('personajes-list');
            const activeCategoryId = list.dataset.activeCategory || 'ALL';
            const activeSubs = list.dataset.activeSubs ? list.dataset.activeSubs.split(',').filter(Boolean) : [];

            const cards = document.querySelectorAll('.character-card');
            cards.forEach(card => {
                const itemCategoryId = card.getAttribute('data-category-id');
                const itemSubCategoryId = card.getAttribute('data-subcategory-id');

                const matchesCategory = activeCategoryId === 'ALL' || itemCategoryId === activeCategoryId;
                const matchesSub = activeSubs.length === 0 || activeSubs.includes(itemSubCategoryId);

                if (matchesCategory && matchesSub) {
                    card.style.display = 'block'; // Flex para mantener layout
                    // Pequeña animación de entrada
                    card.style.opacity = '0';
                    card.style.transform = 'scale(0.95)';
                    setTimeout(() => {
                        card.style.opacity = '1';
                        card.style.transform = 'scale(1)';
                    }, 50);
                } else {
                    card.style.display = 'none';
                }
            });
        }

        // --- ANIMACIÓN ESTELAR DEL BOTÓN ---
        document.addEventListener('DOMContentLoaded', function() {
            const heroBtn = document.getElementById('hero-cta-btn');
            const fabBtn = document.getElementById('fab-create-btn');
            const starParticle = document.getElementById('star-particle');

            if (!heroBtn || !fabBtn) return;

            let isFabVisible = false;
            let isAnimating = false;

            // NUEVA LÓGICA DE SCROLL
            function checkScroll() {
                const rect = heroBtn.getBoundingClientRect();

                // Si el botón está subiendo y ya pasó la parte superior (o está muy cerca)
                // Ajustamos el umbral a 150px desde el top (cerca del header)
                if (rect.top < 150) {
                    if (!isFabVisible && !isAnimating) {
                        // Ocultar botón original
                        heroBtn.classList.add('hidden-hero');
                        animateStarTransition();
                    }
                } else {
                    // Si el usuario vuelve a subir y el botón baja a una posición visible
                    if (isFabVisible && rect.top > 300) {
                        hideFab();
                        // Mostrar botón original
                        heroBtn.classList.remove('hidden-hero');
                    }
                }
            }

            // Escuchar el evento scroll
            window.addEventListener('scroll', checkScroll);
            // Chequear al inicio por si ya está scrolleado
            checkScroll();

            function animateStarTransition() {
                isAnimating = true;

                // 1. Obtener posiciones
                const heroRect = heroBtn.getBoundingClientRect();
                const fabRect = fabBtn.getBoundingClientRect();

                // 2. Posicionar la estrella en el botón del Hero
                // (Usamos coordenadas fijas relativas a la ventana)
                const startX = heroRect.left + heroRect.width / 2;
                const startY = heroRect.top + heroRect.height / 2;

                // Destino: centro del FAB
                // Si el FAB está oculto (scale 0), getBoundingClientRect puede dar valores raros,
                // así que calculamos basándonos en su posición CSS fija (bottom: 30px, right: 30px)
                const endX = window.innerWidth - 30 - (fabRect.width / 2 || 60);
                const endY = window.innerHeight - 30 - (fabRect.height / 2 || 25);

                // 3. Configurar estado inicial de la estrella
                starParticle.style.left = `${startX}px`;
                starParticle.style.top = `${startY}px`;
                starParticle.style.opacity = '1';
                starParticle.style.transition = 'none'; // Resetear transición

                // Calcular ángulo para la cola de la estrella
                const deltaX = endX - startX;
                const deltaY = endY - startY;
                const angle = Math.atan2(deltaY, deltaX) * 180 / Math.PI;
                starParticle.style.transform = `translate(-50%, -50%) rotate(${angle}deg)`;

                // Forzar reflow
                void starParticle.offsetWidth;

                // 4. Iniciar animación de viaje
                starParticle.style.transition = 'all 0.6s cubic-bezier(0.5, 0, 0, 1)'; // Aceleración tipo cohete
                starParticle.style.left = `${endX}px`;
                starParticle.style.top = `${endY}px`;

                // 5. Al terminar el viaje
                setTimeout(() => {
                    // Ocultar estrella
                    starParticle.style.opacity = '0';

                    // Mostrar FAB con efecto POP
                    fabBtn.classList.add('visible');
                    isFabVisible = true;
                    isAnimating = false;
                }, 600); // Duración coincidente con la transición CSS
            }

            function hideFab() {
                fabBtn.classList.remove('visible');
                isFabVisible = false;
            }
        });

        // --- LÓGICA DE CUPONES (COPIADA DE WORKSPACE) ---
        function redeemCoupon() {
            const code = document.getElementById('coupon-code').value.trim();
            const messageDiv = document.getElementById('coupon-message');
            if (!code) {
                messageDiv.style.color = '#ef4444';
                messageDiv.textContent = 'Please enter a code.';
                return;
            }
            const formData = new FormData();
            formData.append('code', code);
            fetch(redeemCouponUrl, {
                method: 'POST',
                headers: { 'X-CSRFToken': csrfToken, 'X-Requested-With': 'XMLHttpRequest' },
                body: new URLSearchParams(formData)
            })
            .then(res => res.json())
            .then(data => {
                if (data.status === 'success') {
                    document.getElementById('coupon-input-container').style.display = 'none';
                    document.getElementById('coupon-footer').style.display = 'none';
                    const successContainer = document.getElementById('coupon-success-container');
                    successContainer.style.display = 'flex';
                    document.getElementById('success-text').textContent = data.message;
                    // Animación de estrellas (simplificada)
                    setTimeout(() => window.location.reload(), 2000);
                } else {
                    messageDiv.style.color = '#ef4444';
                    messageDiv.textContent = data.message;
                }
            })
            .catch(() => {
                messageDiv.style.color = '#ef4444';
                messageDiv.textContent = 'Connection error.';
            });
        }

        // Cerrar modal al hacer clic fuera
        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.style.display = 'none';
            }
        }
    </script>
    <script src="{% static 'myapp/js/scripts.js' %}"></script>

</body>
</html>
